(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/public/publish-post"],{1295:function(t,e,i){},"2d86":function(t,e,i){"use strict";i.r(e);var s=i("4664"),n=i.n(s);for(var o in s)["default"].indexOf(o)<0&&function(t){i.d(e,t,(function(){return s[t]}))}(o);e["default"]=n.a},4664:function(t,e,i){"use strict";(function(t){var s=i("4ea4");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=s(i("2eee")),o=s(i("c973")),r={components:{visiblePopup:function(){i.e("pages/public/inPublishPost/visiblePopup").then(function(){return resolve(i("bd2c"))}.bind(null,i)).catch(i.oe)},selectAddressShowPopup:function(){i.e("pages/public/inPublishPost/selectAddressShowPopup").then(function(){return resolve(i("5a93"))}.bind(null,i)).catch(i.oe)}},data:function(){return{navHeight:44,statusBarHeight:t.getSystemInfoSync().statusBarHeight,navBarHeight:48,urls:[],requestParam:{content:"",fileIdListOfImage:[],visibleCode:"all",detailIdOfLocation:""},isMoving:!1,addressTitle:"",visibleText:"所有人可见",isPublishing:!1}},mounted:function(){this.navHeight=44,this.navHeight=-1!=t.getSystemInfoSync().system.indexOf("ios")?44:48,this.navBarHeight=this.navHeight- -this.statusBarHeight},methods:{publish:function(){var e=this;return(0,o.default)(n.default.mark((function i(){var s,o;return n.default.wrap((function(i){while(1)switch(i.prev=i.next){case 0:e.isPublishing=!0,t.showLoading({title:"发布中...",mask:!0}),s=n.default.mark((function i(s){return n.default.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return i.next=2,new Promise((function(i,n){e.$kt.request.uploadFile({name:"file",filePath:e.urls[s].path,formData:{groupCode:"post"},success:function(s){var n=JSON.parse(s.data);e.requestParam.fileIdListOfImage.push(n.data.id),t.hideLoading(),i(s)},fail:function(t){n(t)}})}));case 2:case"end":return i.stop()}}),i)})),o=0;case 4:if(!(o<e.urls.length)){i.next=9;break}return i.delegateYield(s(o),"t0",6);case 6:o++,i.next=4;break;case 9:e.$kt.request.request({api:e.$api.business.ovo.post.publish,data:e.requestParam,stateSuccess:function(e){t.$emit("postPublish"),t.redirectTo({url:"/pages/public/user-info?isMe=1"})}});case 10:case"end":return i.stop()}}),i)})))()},selectAddressShowPopupSelect:function(t){this.requestParam.detailIdOfLocation=t.detailIdOfLocation,this.addressTitle=t.addressTitle},visiblePopupSelect:function(t){this.requestParam.visibleCode=t.code,this.visibleText=t.text},openSetting:function(){t.openSetting({success:function(t){console.log(t),t.authSetting["scope.userLocation"]}})},getLocation:function(){var e=this;t.getLocation({type:"gcj02",success:function(i){var s=i.latitude.toFixed(5),n=i.longitude.toFixed(5);e.$kt.request.request({api:e.$api.business.ovo.userBind.updateLocation,data:{latitude:s,longitude:n},stateSuccess:function(i){t.setStorageSync("ovoSelfInfo",i.data),t.setStorageSync("pageGetLocationFail","0"),setTimeout((function(){t.$emit("changeOvoSelfInfo",i.data),e.toSelectAddress()}),10)}})}})},toSelectAddress:function(){this.$refs.selectAddressShowPopup.open()},toAddress:function(){var e=this;t.getSetting({success:function(t){console.log(t),null==t.authSetting["scope.userLocation"]?e.$ovo.getLocation():t.authSetting["scope.userLocation"]?e.toSelectAddress():e.openSetting()}})},addImg:function(){var e=this;if(this.urls.length>=9)return t.showToast({title:"最多只能上传9张图片",icon:"none"}),!1;t.chooseImage({count:9-this.urls.length,sizeType:["original","compressed"],sourceType:["album","camera"],success:function(t){for(var i=t.tempFilePaths,s=0;s<i.length;s++)e.urls.push({path:i[s],optShow:!1})}})},previewImage:function(e){for(var i=[],s=0;s<this.urls.length;s++)i.push(this.urls[s].path);t.previewImage({current:e,urls:i})},openOpt:function(t){var e=this;setTimeout((function(){for(var i=0;i<e.urls.length;i++)e.urls[i].optShow=!1;e.urls[t].optShow=!0}),10)},closeOpt:function(t){this.urls[t].optShow=!1},closeAllOpt:function(){for(var t=0;t<this.urls.length;t++)this.urls[t].optShow=!1},moveImg:function(t,e){var i=this;if(this.isMoving)return!1;if(this.isMoving=!0,"top"==e){if(0==t)return!1;var s=this.urls[t];this.urls.splice(t,1),this.urls.splice(t-3,0,s),this.openOpt(t-3)}else if("bottom"==e){if(t==this.urls.length-1)return!1;s=this.urls[t];this.urls.splice(t,1),this.urls.splice(t+3,0,s),this.openOpt(t+3)}else if("rightBottom"==e){if(t==this.urls.length-4)return!1;s=this.urls[t];this.urls.splice(t,1),this.urls.splice(t+4,0,s),this.openOpt(t+4)}else if("leftBottom"==e){if(t<1||t>this.urls.length-2)return!1;s=this.urls[t];this.urls.splice(t,1),this.urls.splice(t+2,0,s),this.openOpt(t+2)}else if("rightTop"==e){if(t<2||t>this.urls.length-1)return!1;s=this.urls[t];this.urls.splice(t,1),this.urls.splice(t-2,0,s),this.openOpt(t-2)}else if("leftTop"==e){if(t<3)return!1;s=this.urls[t];this.urls.splice(t,1),this.urls.splice(t-4,0,s),this.openOpt(t-4)}else if("left"==e){if(0==t)return!1;s=this.urls[t];this.urls.splice(t,1),this.urls.splice(t-1,0,s),this.openOpt(t-1)}else{if(t==this.urls.length-1)return!1;s=this.urls[t];this.urls.splice(t,1),this.urls.splice(t+1,0,s),this.openOpt(t+1)}setTimeout((function(){i.isMoving=!1}),500)}}};e.default=r}).call(this,i("543d")["default"])},"65b0":function(t,e,i){"use strict";var s=i("1295"),n=i.n(s);n.a},"86b5":function(t,e,i){"use strict";i.d(e,"b",(function(){return n})),i.d(e,"c",(function(){return o})),i.d(e,"a",(function(){return s}));var s={ktNavBar:function(){return i.e("uni_modules/uniapp-kantboot/components/kt-nav-bar/kt-nav-bar").then(i.bind(null,"4a2b"))},addressLab:function(){return i.e("components/address-lab/address-lab").then(i.bind(null,"42cd"))},eyeLab:function(){return i.e("components/eye-lab/eye-lab").then(i.bind(null,"1f28"))}},n=function(){var t=this,e=t.$createElement,i=(t._self._c,t.isPublishing?null:""!=t.requestParam.content&&null!=t.requestParam.content||t.urls.length>0),s=t.__map(t.urls,(function(e,i){var s=t.__get_orig(e),n=e.optShow?null:t.$kt.file.byPath("image/icon/delete.svg"),o=e.optShow&&i>0?t.$kt.file.byPath("image/icon/arrowRight2.svg"):null,r=e.optShow?t.urls.length:null,u=e.optShow&&i<r-1?t.$kt.file.byPath("image/icon/arrowRight2.svg"):null,l=e.optShow&&i>2?t.$kt.file.byPath("image/icon/arrowRight2.svg"):null,a=e.optShow?t.urls.length:null,c=e.optShow&&i<a-3?t.$kt.file.byPath("image/icon/arrowRight2.svg"):null,h=e.optShow?i<t.urls.length-4&&2!=i:null,p=e.optShow&&h?t.$kt.file.byPath("image/icon/arrowRight2.svg"):null,f=e.optShow?i>0&&i<t.urls.length-2&&3!=i&&6!=i:null,g=e.optShow&&f?t.$kt.file.byPath("image/icon/arrowRight2.svg"):null,d=e.optShow&&i>3&&6!=i?t.$kt.file.byPath("image/icon/arrowRight2.svg"):null,v=e.optShow&&i>2&&5!=i&&8!=i?t.$kt.file.byPath("image/icon/arrowRight2.svg"):null;return{$orig:s,g1:n,g2:o,g3:r,g4:u,g5:l,g6:a,g7:c,g8:h,g9:p,g10:f,g11:g,g12:d,g13:v}})),n=t.urls.length,o=t.requestParam.content.length;t._isMounted||(t.e0=function(e,i){var s=arguments[arguments.length-1].currentTarget.dataset,n=s.eventParams||s["event-params"];i=n.index;return t.urls.splice(i,1)},t.e1=function(e){return t.$refs.visiblePopup.open()}),t.$mp.data=Object.assign({},{$root:{g0:i,l0:s,g14:n,g15:o}})},o=[]},a78c:function(t,e,i){"use strict";(function(t,e){var s=i("4ea4");i("b10a"),i("5c17"),i("a9ff");s(i("66fd"));var n=s(i("d84f"));t.__webpack_require_UNI_MP_PLUGIN__=i,e(n.default)}).call(this,i("bc2e")["default"],i("543d")["createPage"])},d84f:function(t,e,i){"use strict";i.r(e);var s=i("86b5"),n=i("2d86");for(var o in n)["default"].indexOf(o)<0&&function(t){i.d(e,t,(function(){return n[t]}))}(o);i("65b0");var r=i("f0c5"),u=Object(r["a"])(n["default"],s["b"],s["c"],!1,null,"6073e30e",null,!1,s["a"],void 0);e["default"]=u.exports}},[["a78c","common/runtime","common/vendor"]]]);