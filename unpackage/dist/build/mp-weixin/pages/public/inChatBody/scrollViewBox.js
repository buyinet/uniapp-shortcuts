(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/public/inChatBody/scrollViewBox"],{"74f6":function(e,t,o){},"8cd7":function(e,t,o){"use strict";o.r(t);var n=o("cb13"),i=o("e81f");for(var r in i)["default"].indexOf(r)<0&&function(e){o.d(t,e,(function(){return i[e]}))}(r);o("de79");var a=o("f0c5"),c=Object(a["a"])(i["default"],n["b"],n["c"],!1,null,"d08a9618",null,!1,n["a"],void 0);t["default"]=c.exports},cb13:function(e,t,o){"use strict";o.d(t,"b",(function(){return i})),o.d(t,"c",(function(){return r})),o.d(t,"a",(function(){return n}));var n={userCard:function(){return o.e("components/user-card/user-card").then(o.bind(null,"26a1"))},avatar:function(){return o.e("components/avatar/avatar").then(o.bind(null,"d690"))}},i=function(){var e=this,t=e.$createElement,o=(e._self._c,e.isToBottom&&e.bodyData.content.length>0),n=e.__map(e.bodyData.content,(function(t,o){var n=e.__get_orig(t),i=t.isShowTime||0==o?e.readableDate(t.gmtCreate):null,r=e.isMeSend(t),a="image"==t.typeCode?e.isMeSend(t):null,c="image"==t.typeCode?e.$kt.file.visit(t.content):null,s="image"==t.typeCode?e.$kt.file.visit(t.content):null,u="video"==t.typeCode?e.isMeSend(t):null,d="video"==t.typeCode?e.$kt.file.visit(t.content):null,l="voice"==t.typeCode?e.isMeSend(t):null,m="voice"==t.typeCode?null!=t.duration&&""!=t.duration&&e.isMeSend(t):null,h="voice"==t.typeCode&&m?(t.duration/1e3).toFixed(0):null,f="voice"==t.typeCode&&m?'"':null,g="voice"!=t.typeCode||e.isPlayingVoice&&e.playingVoiceItem.content==t.content?null:e.isMeSend(t),v="voice"!=t.typeCode||e.isPlayingVoice&&e.playingVoiceItem.content==t.content?null:e.$kt.file.byPath("image/icon/voice.svg"),p="voice"==t.typeCode&&e.isPlayingVoice&&e.playingVoiceItem.content==t.content?e.isMeSend(t):null,y="voice"==t.typeCode&&e.isPlayingVoice&&e.playingVoiceItem.content==t.content&&0==e.voiceIconIndex?e.$kt.file.byPath("image/icon/voiceInPlay0.png"):null,I="voice"==t.typeCode&&e.isPlayingVoice&&e.playingVoiceItem.content==t.content&&1==e.voiceIconIndex?e.$kt.file.byPath("image/icon/voiceInPlay1.png"):null,b="voice"==t.typeCode&&e.isPlayingVoice&&e.playingVoiceItem.content==t.content&&2==e.voiceIconIndex?e.$kt.file.byPath("image/icon/voice.svg"):null,C="voice"==t.typeCode?null!=t.duration&&""!=t.duration&&!e.isMeSend(t):null,P="voice"==t.typeCode&&C?(t.duration/1e3).toFixed(0):null,M="voice"==t.typeCode&&C?'"':null,D=e.isMeSend(t);return{$orig:n,m0:i,m1:r,m2:a,g1:c,g2:s,m3:u,g3:d,m4:l,m5:m,g4:h,t0:f,m6:g,g5:v,m7:p,g6:y,g7:I,g8:b,m8:C,g9:P,t1:M,m9:D}}));e.$mp.data=Object.assign({},{$root:{g0:o,l0:n}})},r=[]},cd18:function(e,t,o){"use strict";(function(e){var n=o("4ea4");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(o("2eee")),r=n(o("c973")),a=(e.getRecorderManager(),e.createInnerAudioContext());a.autoplay=!0;var c={props:{room:{type:Object,default:function(){return{}}},height:{type:String,default:"100%"}},data:function(){return{isToBottom:!1,isRefresherTriggered:!1,isRefresherEnabled:!0,requestParam:{typeCode:"privateChat",roomId:"",otherUserId:"",pageNumber:1},bodyData:{content:[]},isLoadOver:!1,playingVoiceItem:{content:""},isPlayingVoice:!1,voiceIconIndex:0,voiceIconInterval:null,roomIdNumber:0}},mounted:function(){if(null!=this.room.id)return e.showLoading({title:"加载中"}),this.roomIdNumber++,this.onRoomChat(),this.requestParam.roomId=this.room.roomId,this.requestParam.typeCode=this.room.typeCode,"privateChat"==this.room.typeCode&&(this.requestParam.otherUserId=this.room.otherUser.userId),this.getBodyData(),!1},methods:{onRoomChat:function(){var t=this;console.log("onRoomChat发起了监听"),e.$on("newChat:roomId:"+this.room.roomId,(function(e){if(t.isRepeat(e))return!1;"privateChat"!=t.requestParam.typeCode||t.isMeSend(e)||(e.ovoUserOfSend=t.room.otherUser,e.isMeSend=!1,t.toBottom()),"privateChat"==t.requestParam.typeCode&&t.isMeSend(e)&&(e.ovoUserOfSend=t.$ovo.getSelf(),e.isMeSend=!0,t.toBottom()),t.bodyDataPush(e)}))},playVoice:function(e){var t=this;if(this.playingVoiceItem.content==e.content)return this.isPlayingVoice=!1,clearInterval(this.voiceIconInterval),a.stop(),this.playingVoiceItem={content:""},!1;clearInterval(this.voiceIconInterval),this.isPlayingVoice=!0,this.playingVoiceItem=e,a.stop(),setTimeout((function(){a.src=t.$kt.file.visit(e.content),console.log(a.src),a.play(),t.voiceIconInterval=setInterval((function(){t.voiceIconIndex++,t.voiceIconIndex>2&&(t.voiceIconIndex=0)}),500),setTimeout((function(){clearInterval(t.voiceIconInterval),t.voiceIconIndex=0,t.isPlayingVoice=!1}),e.duration)}),100)},toBottom:function(){var e=this;this.isToBottom=!1,setTimeout((function(){e.isToBottom=!0}),10)},readableDate:function(e){var t=(new Date).getTime();if(t-e<6e4)return"刚刚";if(t-e<36e5){var o=Math.floor((t-e)/6e4);return o+"分钟前"}var n=new Date(t),i=new Date(e);return n.getFullYear()==i.getFullYear()&&n.getMonth()==i.getMonth()&&n.getDate()==i.getDate()?this.$kt.util.dateFromat(e,"hh:mm"):n.getFullYear()==i.getFullYear()&&n.getMonth()==i.getMonth()&&n.getDate()-i.getDate()==1?"昨天 "+this.$kt.util.dateFromat(e,"hh:mm"):n.getFullYear()==i.getFullYear()&&n.getMonth()==i.getMonth()?this.$kt.util.dateFromat(e,"MM-dd hh:mm"):this.$kt.util.dateFromat(e,"yyyy-MM-dd hh:mm")},refresherpulling:function(){var e=this;return!this.isRefresherTriggered&&(this.isRefresherTriggered=!0,setTimeout((function(){e.isRefresherTriggered=!1}),1e3),!!this.isRefresherEnabled&&void this.getBodyData())},getBodyData:function(){var t=this;return(0,r.default)(i.default.mark((function o(){return i.default.wrap((function(o){while(1)switch(o.prev=o.next){case 0:if(null!=t.room.id&&""!=t.room.id){o.next=2;break}return o.abrupt("return",!1);case 2:return t.requestParam.roomId=t.room.id,o.next=5,new Promise((function(o,n){t.$kt.request.request({api:t.$api.business.ovo.chat.getByRoomId,data:t.requestParam,stateSuccess:function(n){var i=n.data.content;if(0==i.length)return t.requestParam.pageNumber--,t.isRefresherEnabled=!1,!1;t.requestParam.pageNumber++;for(var r=0;r<i.length;r++)i[r].isShowTime=0==r||i[r].gmtCreate-i[r-1].gmtCreate>3e5,t.bodyDataAdd(i[r]),t.isLoadOver||t.toBottom();t.isLoadOver||e.hideLoading(),t.isLoadOver=!0,o()}})}));case 5:case"end":return o.stop()}}),o)})))()},bodyDataAdd:function(e){var t=this;return(0,r.default)(i.default.mark((function o(){return i.default.wrap((function(o){while(1)switch(o.prev=o.next){case 0:return e.isMeSend=t.isMeSend(e),o.next=3,new Promise((function(o,n){t.isLoadOver?setTimeout((function(){if(t.isRepeat(e))return o(),!1;t.bodyData.content.unshift(e),o()}),200):(t.bodyData.content.unshift(e),t.toBottom(),o())}));case 3:case"end":return o.stop()}}),o)})))()},bodyDataPush:function(e){console.log("bodyDataPush"),this.bodyData.content.push(e)},isMeSend:function(e){return e.userIdOfSend==this.$ovo.getSelf().userId},isRepeat:function(e){for(var t=0;t<this.bodyData.content.length;t++)if(this.bodyData.content[t].id==e.id)return!0;return!1},previewImage:function(t){e.previewImage({urls:[t],current:t})}},watch:{room:{handler:function(e,t){null!=this.room.id&&""!=this.room.id&&(console.log("room.id:"+this.room.id),0==this.roomIdNumber&&(this.onRoomChat(),this.$forceUpdate()))},deep:!0,immediate:!0}}};t.default=c}).call(this,o("543d")["default"])},de79:function(e,t,o){"use strict";var n=o("74f6"),i=o.n(n);i.a},e81f:function(e,t,o){"use strict";o.r(t);var n=o("cd18"),i=o.n(n);for(var r in n)["default"].indexOf(r)<0&&function(e){o.d(t,e,(function(){return n[e]}))}(r);t["default"]=i.a}}]);
;(global["webpackJsonp"] = global["webpackJsonp"] || []).push([
    'pages/public/inChatBody/scrollViewBox-create-component',
    {
        'pages/public/inChatBody/scrollViewBox-create-component':(function(module, exports, __webpack_require__){
            __webpack_require__('543d')['createComponent'](__webpack_require__("8cd7"))
        })
    },
    [['pages/public/inChatBody/scrollViewBox-create-component']]
]);
